(()=>{"use strict";var e,t,r={787:(e,t,r)=>{r.d(t,{v0:()=>d});const n={"Content-Type":"application/json"},o=/\{[^{}]+\}/g;class s extends Request{constructor(e,t){super(e,t);for(const e in t)e in this||(this[e]=t[e])}}function a(e,t,r){if(null==t)return"";if("object"==typeof t)throw new Error("Deeply-nested arrays/objects arenâ€™t supported. Provide your own `querySerializer()` to handle these.");return`${e}=${!0===r?.allowReserved?t:encodeURIComponent(t)}`}function i(e,t,r){if(!t||"object"!=typeof t)return"";const n=[],o={simple:",",label:".",matrix:";"}[r.style]||"&";if("deepObject"!==r.style&&!1===r.explode){for(const e in t)n.push(e,!0===r.allowReserved?t[e]:encodeURIComponent(t[e]));const o=n.join(",");switch(r.style){case"form":return`${e}=${o}`;case"label":return`.${o}`;case"matrix":return`;${e}=${o}`;default:return o}}for(const o in t){const s="deepObject"===r.style?`${e}[${o}]`:o;n.push(a(s,t[o],r))}const s=n.join(o);return"label"===r.style||"matrix"===r.style?`${o}${s}`:s}function c(e,t,r){if(!Array.isArray(t))return"";if(!1===r.explode){const n={form:",",spaceDelimited:"%20",pipeDelimited:"|"}[r.style]||",",o=(!0===r.allowReserved?t:t.map((e=>encodeURIComponent(e)))).join(n);switch(r.style){case"simple":return o;case"label":return`.${o}`;case"matrix":return`;${e}=${o}`;default:return`${e}=${o}`}}const n={simple:",",label:".",matrix:";"}[r.style]||"&",o=[];for(const n of t)"simple"===r.style||"label"===r.style?o.push(!0===r.allowReserved?n:encodeURIComponent(n)):o.push(a(e,n,r));return"label"===r.style||"matrix"===r.style?`${n}${o.join(n)}`:o.join(n)}function u(e){return function(t){const r=[];if(t&&"object"==typeof t)for(const n in t){const o=t[n];null!=o&&(Array.isArray(o)?r.push(c(n,o,{style:"form",explode:!0,...e?.array,allowReserved:e?.allowReserved||!1})):"object"!=typeof o?r.push(a(n,o,e)):r.push(i(n,o,{style:"deepObject",explode:!0,...e?.object,allowReserved:e?.allowReserved||!1})))}return r.join("&")}}function l(e){return JSON.stringify(e)}function f(...e){const t=new Headers;for(const r of e){if(!r||"object"!=typeof r)continue;const e=r instanceof Headers?r.entries():Object.entries(r);for(const[r,n]of e)if(null===n)t.delete(r);else if(Array.isArray(n))for(const e of n)t.append(r,e);else void 0!==n&&t.set(r,n)}return t}const p=e=>function(e){let{baseUrl:t="",fetch:r=globalThis.fetch,querySerializer:p,bodySerializer:d,headers:y,...m}={...e};t.endsWith("/")&&(t=t.substring(0,t.length-1)),y=f(n,y);const h=[];async function g(e,n){const{fetch:g=r,headers:b,params:v={},parseAs:w="json",querySerializer:S,bodySerializer:j=d??l,...E}=n||{};let T="function"==typeof p?p:u(p);S&&(T="function"==typeof S?S:u({..."object"==typeof p?p:{},...S}));const q={redirect:"follow",...m,...E,headers:f(y,b,v.header)};q.body&&(q.body=j(q.body)),q.body instanceof FormData&&q.headers.delete("Content-Type");let R=new s(function(e,t){let r=`${t.baseUrl}${e}`;t.params?.path&&(r=function(e,t){let r=e;for(const n of e.match(o)??[]){let e=n.substring(1,n.length-1),o=!1,s="simple";if(e.endsWith("*")&&(o=!0,e=e.substring(0,e.length-1)),e.startsWith(".")?(s="label",e=e.substring(1)):e.startsWith(";")&&(s="matrix",e=e.substring(1)),!t||void 0===t[e]||null===t[e])continue;const u=t[e];r=Array.isArray(u)?r.replace(n,c(e,u,{style:s,explode:o})):"object"!=typeof u?"matrix"!==s?r.replace(n,"label"===s?`.${u}`:u):r.replace(n,`;${a(e,u)}`):r.replace(n,i(e,u,{style:s,explode:o}))}return r}(r,t.params.path));let n=t.querySerializer(t.params.query??{});return n.startsWith("?")&&(n=n.substring(1)),n&&(r+=`?${n}`),r}(e,{baseUrl:t,params:v,querySerializer:T}),q);const O={baseUrl:t,fetch:g,parseAs:w,querySerializer:T,bodySerializer:j};for(const t of h)if(t&&"object"==typeof t&&"function"==typeof t.onRequest){R.schemaPath=e,R.params=v;const r=await t.onRequest(R,O);if(r){if(!(r instanceof Request))throw new Error("Middleware must return new Request() when modifying the request");R=r}}let $=await g(R);for(let e=h.length-1;e>=0;e--){const t=h[e];if(t&&"object"==typeof t&&"function"==typeof t.onResponse){const e=await t.onResponse($,O);if(e){if(!(e instanceof Response))throw new Error("Middleware must return new Response() when modifying the response");$=e}}}if(204===$.status||"0"===$.headers.get("Content-Length"))return $.ok?{data:{},response:$}:{error:{},response:$};if($.ok)return"stream"===w?{data:$.body,response:$}:{data:await $[w](),response:$};let x=await $.text();try{x=JSON.parse(x)}catch{}return{error:x,response:$}}return{GET:async(e,t)=>g(e,{...t,method:"GET"}),PUT:async(e,t)=>g(e,{...t,method:"PUT"}),POST:async(e,t)=>g(e,{...t,method:"POST"}),DELETE:async(e,t)=>g(e,{...t,method:"DELETE"}),OPTIONS:async(e,t)=>g(e,{...t,method:"OPTIONS"}),HEAD:async(e,t)=>g(e,{...t,method:"HEAD"}),PATCH:async(e,t)=>g(e,{...t,method:"PATCH"}),TRACE:async(e,t)=>g(e,{...t,method:"TRACE"}),use(...e){for(const t of e)if(t){if("object"!=typeof t||!("onRequest"in t)&&!("onResponse"in t))throw new Error("Middleware must be an object with one of `onRequest()` or `onResponse()`");h.push(t)}},eject(...e){for(const t of e){const e=h.indexOf(t);-1!==e&&h.splice(e,1)}}}}(e);class d{backendClient;constructor(e){this.backendClient=p({baseUrl:e??"https://api.adoralytics.com"})}async startSession({bypassSampling:e,orgId:t,language:r,domain:n,userCohorts:o,uid:s,devicePixelRatio:a,compressionType:i}){return this.backendClient.POST("/sessions/start",{body:{bypassSampling:e,orgId:t,language:r,domain:n,devicePixelRatio:a,userCohorts:o||{},uid:"number"==typeof s?s.toString():"null"!==s&&"undefined"!==s?s:void 0,compressionType:i},mode:"cors"})}async saveSessionEvents(e,t,r){return this.backendClient.POST("/sessions/{sessionId}/events",{params:{path:{sessionId:e}},body:{events:t.slice(),metadata:r},mode:"cors"})}}},602:(e,t,r)=>{var n,o;r.d(t,{Pe:()=>i,dF:()=>n,pL:()=>s}),function(e){e.Extension="adoraSessionExtension",e.Script="adoraSessionScript"}(n||(n={})),function(e){e.Script="adoraEventsScript",e.Extension="adoraEventsExtension"}(o||(o={}));class s{storage;eventStorageKey;constructor(e,t){this.storage=t,this.eventStorageKey=e===n.Script?o.Script:o.Extension}getEvents(){const e=this.storage.getItem(this.eventStorageKey);return e?JSON.parse(e):null}setEvents(e){this.storage.setItem(this.eventStorageKey,JSON.stringify(e))}removeEvents(){this.storage.removeItem(this.eventStorageKey)}}function a(e){return`${e}-rate-limit-timestamp`}class i{sessionType;storage;constructor(e,t){this.sessionType=e,this.storage=t}get lastRateLimitedTimestamp(){const e=this.storage.getItem(a(this.sessionType));if(!isNaN(Number(e)))return e}clearLastRateLimitedTimestamp(){this.storage.removeItem(a(this.sessionType))}setLastRateLimitedTimestamp(e){this.storage.setItem(a(this.sessionType),e.toString())}getSession(){const e=this.storage.getItem(this.sessionType);return e?JSON.parse(e):null}setSession(e){this.storage.setItem(this.sessionType,JSON.stringify(e))}removeSession(){this.storage.removeItem(this.sessionType)}}},399:(e,t,r)=>{function n(e,...t){}r.d(t,{c:()=>n})},397:(e,t,r)=>{r.d(t,{q:()=>n});class n{getItem(e){if(!o())return null;try{return window.sessionStorage.getItem(e)}catch(e){return null}}setItem(e,t){if(!o())return null;try{return window.sessionStorage.setItem(e,t)}catch(e){return null}}removeItem(e){if(!o())return null;try{return window.sessionStorage.removeItem(e)}catch(e){return null}}}function o(){return"object"==typeof window.sessionStorage}}},n={};function o(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={exports:{}};return r[e](s,s.exports,o),s.exports}o.m=r,o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,r)=>(o.f[r](e,t),t)),[])),o.u=e=>e+".adora-start.js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="@adora/web-recorder-rrweb:",o.l=(r,n,s,a)=>{if(e[r])e[r].push(n);else{var i,c;if(void 0!==s)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var f=u[l];if(f.getAttribute("src")==r||f.getAttribute("data-webpack")==t+s){i=f;break}}i||(c=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,o.nc&&i.setAttribute("nonce",o.nc),i.setAttribute("data-webpack",t+s),i.src=r),e[r]=[n];var p=(t,n)=>{i.onerror=i.onload=null,clearTimeout(d);var o=e[r];if(delete e[r],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach((e=>e(n))),t)return t(n)},d=setTimeout(p.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=p.bind(null,i.onerror),i.onload=p.bind(null,i.onload),c&&document.head.appendChild(i)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=r[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})(),(()=>{var e={792:0};o.f.j=(t,r)=>{var n=o.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var s=new Promise(((r,o)=>n=e[t]=[r,o]));r.push(n[2]=s);var a=o.p+o.u(t),i=new Error;o.l(a,(r=>{if(o.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var s=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.src;i.message="Loading chunk "+t+" failed.\n("+s+": "+a+")",i.name="ChunkLoadError",i.type=s,i.request=a,n[1](i)}}),"chunk-"+t,t)}};var t=(t,r)=>{var n,s,[a,i,c]=r,u=0;if(a.some((t=>0!==e[t]))){for(n in i)o.o(i,n)&&(o.m[n]=i[n]);c&&c(o)}for(t&&t(r);u<a.length;u++)s=a[u],o.o(e,s)&&e[s]&&e[s][0](),e[s]=0},r=self.webpackChunk_adora_web_recorder_rrweb=self.webpackChunk_adora_web_recorder_rrweb||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var s=Object.getOwnPropertyNames,a=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty;function c(e,t){return function(r,n,o){return e(r,n,o)&&t(r,n,o)}}function u(e){return function(t,r,n){if(!t||!r||"object"!=typeof t||"object"!=typeof r)return e(t,r,n);var o=n.cache,s=o.get(t),a=o.get(r);if(s&&a)return s===r&&a===t;o.set(t,r),o.set(r,t);var i=e(t,r,n);return o.delete(t),o.delete(r),i}}function l(e){return s(e).concat(a(e))}var f=Object.hasOwn||function(e,t){return i.call(e,t)};function p(e,t){return e||t?e===t:e===t||e!=e&&t!=t}var d="_owner",y=Object.getOwnPropertyDescriptor,m=Object.keys;function h(e,t,r){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;return!0}function g(e,t){return p(e.getTime(),t.getTime())}function b(e,t,r){if(e.size!==t.size)return!1;for(var n,o,s={},a=e.entries(),i=0;(n=a.next())&&!n.done;){for(var c=t.entries(),u=!1,l=0;(o=c.next())&&!o.done;){var f=n.value,p=f[0],d=f[1],y=o.value,m=y[0],h=y[1];u||s[l]||!(u=r.equals(p,m,i,l,e,t,r)&&r.equals(d,h,p,m,e,t,r))||(s[l]=!0),l++}if(!u)return!1;i++}return!0}function v(e,t,r){var n,o=m(e),s=o.length;if(m(t).length!==s)return!1;for(;s-- >0;){if((n=o[s])===d&&(e.$$typeof||t.$$typeof)&&e.$$typeof!==t.$$typeof)return!1;if(!f(t,n)||!r.equals(e[n],t[n],n,n,e,t,r))return!1}return!0}function w(e,t,r){var n,o,s,a=l(e),i=a.length;if(l(t).length!==i)return!1;for(;i-- >0;){if((n=a[i])===d&&(e.$$typeof||t.$$typeof)&&e.$$typeof!==t.$$typeof)return!1;if(!f(t,n))return!1;if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;if(o=y(e,n),s=y(t,n),(o||s)&&(!o||!s||o.configurable!==s.configurable||o.enumerable!==s.enumerable||o.writable!==s.writable))return!1}return!0}function S(e,t){return p(e.valueOf(),t.valueOf())}function j(e,t){return e.source===t.source&&e.flags===t.flags}function E(e,t,r){if(e.size!==t.size)return!1;for(var n,o,s={},a=e.values();(n=a.next())&&!n.done;){for(var i=t.values(),c=!1,u=0;(o=i.next())&&!o.done;)c||s[u]||!(c=r.equals(n.value,o.value,n.value,o.value,e,t,r))||(s[u]=!0),u++;if(!c)return!1}return!0}function T(e,t){var r=e.length;if(t.length!==r)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}var q=Array.isArray,R="function"==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView:null,O=Object.assign,$=Object.prototype.toString.call.bind(Object.prototype.toString),x=A();function A(e){void 0===e&&(e={});var t,r=e.circular,n=void 0!==r&&r,o=e.createInternalComparator,s=e.createState,a=e.strict,i=void 0!==a&&a,l=function(e){var t=e.circular,r=e.createCustomConfig,n=e.strict,o={areArraysEqual:n?w:h,areDatesEqual:g,areMapsEqual:n?c(b,w):b,areObjectsEqual:n?w:v,arePrimitiveWrappersEqual:S,areRegExpsEqual:j,areSetsEqual:n?c(E,w):E,areTypedArraysEqual:n?w:T};if(r&&(o=O({},o,r(o))),t){var s=u(o.areArraysEqual),a=u(o.areMapsEqual),i=u(o.areObjectsEqual),l=u(o.areSetsEqual);o=O({},o,{areArraysEqual:s,areMapsEqual:a,areObjectsEqual:i,areSetsEqual:l})}return o}(e),f=function(e){var t=e.areArraysEqual,r=e.areDatesEqual,n=e.areMapsEqual,o=e.areObjectsEqual,s=e.arePrimitiveWrappersEqual,a=e.areRegExpsEqual,i=e.areSetsEqual,c=e.areTypedArraysEqual;return function(e,u,l){if(e===u)return!0;if(null==e||null==u||"object"!=typeof e||"object"!=typeof u)return e!=e&&u!=u;var f=e.constructor;if(f!==u.constructor)return!1;if(f===Object)return o(e,u,l);if(q(e))return t(e,u,l);if(null!=R&&R(e))return c(e,u,l);if(f===Date)return r(e,u,l);if(f===RegExp)return a(e,u,l);if(f===Map)return n(e,u,l);if(f===Set)return i(e,u,l);var p=$(e);return"[object Date]"===p?r(e,u,l):"[object RegExp]"===p?a(e,u,l):"[object Map]"===p?n(e,u,l):"[object Set]"===p?i(e,u,l):"[object Object]"===p?"function"!=typeof e.then&&"function"!=typeof u.then&&o(e,u,l):"[object Arguments]"===p?o(e,u,l):("[object Boolean]"===p||"[object Number]"===p||"[object String]"===p)&&s(e,u,l)}}(l);return function(e){var t=e.circular,r=e.comparator,n=e.createState,o=e.equals,s=e.strict;if(n)return function(e,a){var i=n(),c=i.cache,u=void 0===c?t?new WeakMap:void 0:c,l=i.meta;return r(e,a,{cache:u,equals:o,meta:l,strict:s})};if(t)return function(e,t){return r(e,t,{cache:new WeakMap,equals:o,meta:void 0,strict:s})};var a={cache:void 0,equals:o,meta:void 0,strict:s};return function(e,t){return r(e,t,a)}}({circular:n,comparator:f,createState:s,equals:o?o(f):(t=f,function(e,r,n,o,s,a,i){return t(e,r,i)}),strict:i})}A({strict:!0}),A({circular:!0}),A({circular:!0,strict:!0}),A({createInternalComparator:function(){return p}}),A({strict:!0,createInternalComparator:function(){return p}}),A({circular:!0,createInternalComparator:function(){return p}}),A({circular:!0,createInternalComparator:function(){return p},strict:!0});var C=o(602),I=o(787),P=o(399),k=o(397);const L=async e=>{const{compressionType:t}=e;Promise.all([o.e(613),o.e(714)]).then(o.bind(o,714)).then((e=>{e.startRecording({sessionType:C.dF.Script,compressionType:t})}))};window.adoraStart=e=>{if("object"!=typeof window.sessionStorage)return;const t=e.compressionType||"RRWEB_PACK";if(!0===window.adoraIsRunning)return;window.adoraIsRunning=!0;const r=new C.Pe(C.dF.Script,new k.q),n=r.lastRateLimitedTimestamp;if(void 0!==n){if(Date.now()-n<18e5)return;r.clearLastRateLimitedTimestamp()}const o=r.getSession();if(o){o.settings.uid=e.uid;const t=structuredClone(o.settings.userCohorts);return x(t,e.userCohorts)||(o.settings.userCohorts=e.userCohorts,r.setSession(o)),void L({compressionType:o.compressionType})}(async(e,t,r)=>{const n=new C.Pe(e,new k.q),o=new I.v0(t.backendUrl),s=await async function(e,t,r){try{const n=await e.startSession({bypassSampling:t.bypassSampling,orgId:t.orgId,language:t.language||navigator.language,domain:new URL(window.location.href).hostname,userCohorts:t.userCohorts||{},uid:t.uid,devicePixelRatio:window.devicePixelRatio,compressionType:r});if(n.error)return{type:"error",code:n.error.code};if(201!==n.response.status)return(0,P.c)("session not created, aborting"),{type:"error",code:"code"in n.data?n.data.code:void 0};if(!n.data||!("session"in n.data))return(0,P.c)("malformed session, exiting"),{type:"error",code:void 0};const{session:o,organization:s}=n.data;return{type:"success",storedSession:{id:o.id,createdAt:o.createdAt,status:o.status,lastSyncedAt:o.lastSyncedAt,domain:o.domain,requestIp:o.requestIp,country:o.country,userAgent:o.userAgent,language:o.language,initialUserCohorts:o.initialUserCohorts,devicePixelRatio:o.devicePixelRatio,organization:s,settings:t,compressionType:o.compressionType}}}catch(e){return{type:"error",code:void 0}}}(o,t,r);return"success"===s.type&&n.setSession(s.storedSession),s})(C.dF.Script,e,t).then((e=>{if("error"!==e.type)return L({compressionType:t});"RateLimitExceeded"===e.code&&r.setLastRateLimitedTimestamp(Date.now())}))}})();
//# sourceMappingURL=adora-start.js.map